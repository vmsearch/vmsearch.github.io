<!DOCTYPE html>
<html lang="zh_cn">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="duma" />

        <meta name="description" content="åºè¨€ ä¸Šä¸€ç¯‡ä¸»è¦è®²äº†ä¸€ä¸‹cxlçš„ä¸‰ç§åè®®å’Œä¸‰ç§è®¾å¤‡ï¼Œè¿™ä¸€ç¯‡ä¸»è¦è®²ä¸€ä¸‹cxlè®¾å¤‡åº•å±‚çš„ä¸€äº›åŸºæœ¬å·¥ä½œåŸç†ã€‚åœ¨cxlçš„æ‹“æ‰‘ç»“æ„å½“ä¸­å¯ä»¥æœ‰cxl host bridgeï¼Œcxl root portï¼Œ cxl switchå’Œcxl endpointè¿™å‡ ç§ç±»å‹çš„è®¾å¤‡ï¼Œä¸‹é¢æˆ‘ä»¬æ¥å…·ä½“çœ‹ä¸€ä¸‹ä¸åŒç±»å‹è®¾å¤‡åœ¨ç¡¬ä»¶ â€¦
" />
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="cxl, cxl hardware, articles, " />
        <title>cxlè§£æç³»åˆ—ä¹‹cxlè®¾å¤‡åº•å±‚å·¥ä½œæœºåˆ¶  Â· KernelNote - AIåŸºç¡€è®¾æ–½æŠ€æœ¯åšå®¢
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="./theme/css/elegant.prod.css" media="screen">
        <link rel="stylesheet" type="text/css" href="./theme/css/custom.css" media="screen">

        <link href="https://kernelnote.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="KernelNote - AIåŸºç¡€è®¾æ–½æŠ€æœ¯åšå®¢ - Full Atom Feed" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LRRMJ08SPD"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-LRRMJ08SPD');
</script>



    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="./"><span class=site-name>KernelNote - AIåŸºç¡€è®¾æ–½æŠ€æœ¯åšå®¢</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       .
                                    >Home</a>
                                </li>
                                <li ><a href="./pages/about.html">about</a></li>
                                <li ><a href="./categories.html">Categories</a></li>
                                <li ><a href="./tags.html">Tags</a></li>
                                <li ><a href="./archives.html">Archives</a></li>
                                <li><form class="navbar-search" action="./search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<!-- æ–‡ç« å¤´éƒ¨åŒºåŸŸ -->
<header class="article-header">
    <div class="article-header-container">
        <!-- ä½œè€…ä¿¡æ¯åŒºåŸŸ -->
        <div class="article-author-section">
            <img src="./images/wechat.jpeg" alt="å‘¨æ¯…åš" class="author-avatar">
            <div class="author-info">
                <h3 class="author-name">å‘¨å®œæ³¢</h3>
                <p class="author-title">AIåŸºç¡€è®¾æ–½æ¶æ„å¸ˆ | AI Agentä¸“å®¶</p>
            </div>
        </div>

        <!-- æ–‡ç« æ ‡é¢˜å’Œå…ƒä¿¡æ¯ -->
        <div class="article-meta-section">
            <h1 class="article-title">
                cxlè§£æç³»åˆ—ä¹‹cxlè®¾å¤‡åº•å±‚å·¥ä½œæœºåˆ¶
            </h1>

            <div class="article-meta-info">
                <div class="meta-item">
                    <span class="meta-icon">ğŸ“…</span>
                    <time datetime="2022-07-24T00:00:00+08:00">æ—¥ 24 ä¸ƒæœˆ 2022</time>
                </div>
                <div class="meta-item">
                    <span class="meta-icon">ğŸ“</span>
                    <span class="category-tag">articles</span>
                </div>
                <div class="meta-item">
                    <span class="meta-icon">ğŸ·ï¸</span>
                    <span class="article-tag">cxl</span>
                    <span class="article-tag">cxl hardware</span>
                </div>
            </div>

            <!-- å¤šåª’ä½“é“¾æ¥åŒºåŸŸ -->
        </div>
    </div>
</header>

<!-- æ–‡ç« ä¸»ä½“å†…å®¹ -->
<div class="article-container">
    <div class="article-main">
        <!-- æ–‡ç« å†…å®¹ -->
            <main class="article-content article-content-no-toc">
                
                <h4>åºè¨€</h4>
<p>ä¸Šä¸€ç¯‡ä¸»è¦è®²äº†ä¸€ä¸‹cxlçš„ä¸‰ç§åè®®å’Œä¸‰ç§è®¾å¤‡ï¼Œè¿™ä¸€ç¯‡ä¸»è¦è®²ä¸€ä¸‹cxlè®¾å¤‡åº•å±‚çš„ä¸€äº›åŸºæœ¬å·¥ä½œåŸç†ã€‚åœ¨cxlçš„æ‹“æ‰‘ç»“æ„å½“ä¸­å¯ä»¥æœ‰cxl host bridgeï¼Œcxl root portï¼Œ cxl switchå’Œcxl endpointè¿™å‡ ç§ç±»å‹çš„è®¾å¤‡ï¼Œä¸‹é¢æˆ‘ä»¬æ¥å…·ä½“çœ‹ä¸€ä¸‹ä¸åŒç±»å‹è®¾å¤‡åœ¨ç¡¬ä»¶å±‚çš„ä¸€äº›å·¥ä½œæœºåˆ¶ã€‚</p>
<h4>DVSEC</h4>
<p>DVSEC(Designated Vendor-Specific Extended Capbility)åœ¨cxl specå½“ä¸­æ–°å¼•å…¥çš„ä¸€ä¸ªcapï¼Œcxlæ‹“æ‰‘ç»“æ„å½“ä¸­çš„æ¯ä¸€ç§è®¾å¤‡éƒ½ä¼šæœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªDVSECï¼Œç„¶åé€šè¿‡è¿™äº›DVSECæ¥å®ç°ç›¸å…³ä¿¡æ¯å¦‚registerçš„å‘ˆç°ã€‚ä¸‹é¢æˆ‘ä»¬æ¥å…ˆçœ‹ä¸€ä¸‹cxl endpointè®¾å¤‡çš„PCIe DVSECã€‚å…·ä½“å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img alt="desec" src="images/desec.png">
<center> å›¾ 1  PCIe DVSEC for cxl device </center>
ç»“åˆä¸Šé¢çš„å›¾æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ cxl device çš„ designated vendor-specific header è®¾ç½®ï¼Œå…·ä½“å¦‚ä¸‹</p>
<p><img alt="dvsec_header" src="images/dvsec_header.png">
<center>å›¾2 designated vendor-specific header </center></p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹<code>cxl cap</code> ç›¸å…³æ ‡å¿—ä½ç¤ºæ„</p>
<p><img alt="cxl_cap_1" src="images/cxl_cap_1.png">
<center> å›¾3  part 1 of cxl capability of pcie dvsec </center></p>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°å‰ä¸‰ä¸ªbitåˆ†åˆ«è¡¨ç¤ºcxl çš„cacheã€ ioã€memè¿™ä¸‰ä¸ªåè®®ä½¿èƒ½çŠ¶æ€ï¼Œcxl.io defaultæ˜¯å¿…é¡»è¦ä½¿èƒ½çš„ã€‚bit3å’Œbits[5:4]éƒ½æ˜¯è·Ÿcxl.memç›¸å…³ã€‚</p>
<p><img alt="cxl_cap_2" src="images/cxl_cap_2.png">
<center> å›¾4 part 2 of cxl capability of pci dvsec </center></p>
<p>bit 6 ä¸»è¦è·Ÿcache writebackå’Œinvalidate èƒ½åŠ›æœ‰å…³ï¼Œåœ¨cxl.cache ä½¿èƒ½çš„æƒ…å†µä¸‹è¿™ä¸ªå¿…é¡»æ˜¯è¦è®¾ç½®ä¸Šçš„ã€‚bit7ï¼Œbits[10:8] ,bit 11éƒ½è·Ÿè®¾å¤‡ Resetæœ‰å…³è”ã€‚</p>
<p><img alt="cxl_cap_3" src="images/cxl_cap_3.png"></p>
<p><center> å›¾5 part 3 of cxl capability of pci dvsec </center></p>
<p>è¿™é‡Œè¯´ä¸€ä¸‹Viral handlingï¼Œå®ƒæ˜¯cxlæ–°å¼•å…¥çš„ä¸€ç§erroræ£€æµ‹æœºåˆ¶ã€‚åœ¨Viral handling å¤„ç†æœºåˆ¶å½“ä¸­ï¼Œå¦‚æœå‘ç°ç›¸å…³errorå®ƒä¼šæ²¿ç€cxl æ‹“æ‰‘æ¶æ„é€çº§ä¸ŠæŠ¥ã€‚</p>
<p>ä¸Šé¢èŠ±äº†ç‚¹ç¯‡å¹…æ¥ä»‹ç»cxl capçš„ç›¸å…³æ ‡å¿—ä½ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹cxl control ç›¸å…³æ ‡å¿—ä½ã€‚</p>
<p><img alt="cxl_control" src="images/cxl_control.png">
<center> å›¾6  cxl control of pci dvsec </center></p>
<p>bit 0ï¼Œbit 2 æ˜¯å¯è¯»å†™çš„ä¹Ÿå°±æ˜¯è¯´å¯ä»¥æ§åˆ¶è®¾å¤‡cacheå’Œmemçš„enableã€‚åœ¨å¾€ä¸‹ç»§ç»­ä¹‹å‰æˆ‘ä»¬å…ˆè®²ä¸€ä¸‹ä»€ä¹ˆæ˜¯Snoop Filterã€‚åœ¨cacheä¸€è‡´æ€§åœºæ™¯ä¸‹ï¼Œæ¯ä¸ªcpuä¸Šéƒ½æœ‰ä¸€ä¸ªsnooperä¹Ÿå°±å—…æ¢å™¨æˆ–è€…è¯´agentï¼Œå®ƒçš„ä½œç”¨æ˜¯monitorç›¸å…³cache blockçš„å˜åŒ–ä»¥ä¾¿update è‡ªå·±cpu ä¸Šçš„cache lineã€‚æ­£å¸¸çš„æ“ä½œæ˜¯è¯´åªè¦memory busæœ‰ç›¸å…³çš„cacheæ“ä½œæ¯”å¦‚æ›´æ–°æŸä¸ªcache blockï¼Œæ¯ä¸ªsnooperéƒ½è¦å»æ£€æŸ¥ä¸€ä¸‹è¿™ä¸ªblockæ˜¯å¦ä¹Ÿåœ¨è‡ªå·±çš„cacheé‡Œé¢ã€‚åœ¨å¤§å¤šæ•°çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæ“ä½œçš„ç»“æœéƒ½æ˜¯æ— æ•ˆçš„ã€‚ä¸ºäº†ä¼˜åŒ–è¿™ä¸ªæ“ä½œï¼Œå°±å¼•å…¥äº†snoop filterå³å¯¹cache block è¿›è¡Œè¿‡æ»¤å»é™¤è®¸å¤šä¸å¿…è¦çš„æ£€æµ‹ã€‚
è®²å®Œè¿™ä¸ªSFï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹bits[7:3]è¡¨ç¤ºçš„æ˜¯SFèƒ½è¦†ç›–å†…å­˜å¤§å°ï¼Œ bits[10:8] è¡¨ç¤ºçš„SFçš„ç²’åº¦ã€‚å…¶ä»–å‡ ä¸ªbitä½çš„å«ä¹‰ä¹Ÿæ¯”è¾ƒç®€å•å¤§å®¶å¯ä»¥è‡ªè¡Œçœ‹ä¸€ä¸‹ã€‚æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹statusç›¸å…³çš„bitä½ï¼Œå¦‚ä¸‹é¢ä¸¤å¹…å›¾æ‰€ç¤º(status and status2)ï¼Œå…¶ä¸­çš„ç¤ºæ„ä¹Ÿå¹¶ä¸éš¾ç†è§£å¤§å®¶å¯ä»¥è‡ªè¡Œçœ‹ä¸€ä¸‹ã€‚</p>
<p><img alt="cxl_dev_status_1" src="images/cxl_dev_status_1.png">
<img alt="cxl_dev_status2" src="images/cxl_dev_status2.png">
<center> å›¾7 cxl status and status2 of pcie dvsec</center>
æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹å›¾1ä¸­çš„range registerçš„ä½œç”¨ã€‚å¦‚æœcxl.mem ä½¿èƒ½ä¸”HDM_COUNT ç­‰äº1çš„è¯åˆ™range 1 registerå¿…é¡»è¦åˆå§‹åŒ–ï¼Œå¦‚æœHDM_COUNT ç­‰äº2çš„è¯åˆ™range 2 register ä¹Ÿå¿…é¡»è¦åˆå§‹åŒ–ã€‚æ¯ä¸ªrange registeréƒ½åŒ…å«4ä¸ªå­çš„registeråˆ†åˆ«æ˜¯Size High, Size Low, Base Higth, Base Lowã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹range 1 register Size Highï¼š</p>
<ul>
<li>bits 31~0è¡¨ç¤ºMemory_Size_Highï¼Œå®ƒæŒ‡çš„æ˜¯HDM sizeçš„bits 63~32ä½ã€‚</li>
</ul>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹range 1 Size Low:</p>
<p><img alt="range1_low_1" src="images/range1_low_1.png">
<center>å›¾8 part 1 of range 1 size low register of pcie dvsec</center></p>
<p>bit 0 å¦‚æœè®¾ç½®ä¸Šåˆ™è¡¨ç¤º range 1 Size high and Size low registeræ˜¯æœ‰æ•ˆçš„ï¼Œbit 1åˆ™è¡¨ç¤ºhdmæ˜¯å¦å¯ç”¨å¦‚æœè¢«è®¾ç½®ä¸Šåˆ™è¡¨ç¤ºcxl hdmå·²ç»åˆå§‹åŒ–å®Œæˆå¤„äºå¯ç”¨çŠ¶æ€ï¼Œbits 4:2 åˆ™è¡¨ç¤ºhdmåº•å±‚æ‰€ä½¿ç”¨çš„å­˜å‚¨ä»‹è´¨ç±»å‹ï¼Œbits 7:5åˆ™è¡¨ç¤º hdmçš„ä½¿ç”¨ç±»å‹æ˜¯ä½œä¸ºæ™®é€šå†…å­˜å»ä½¿ç”¨è¿˜æ˜¯ä½œä¸ºstorageå»ä½¿ç”¨ï¼Œæˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹</p>
<p><img alt="cxl_range1_reg_2" src="images/cxl_range1_reg_2.png">
<center>å›¾9 part 2 of range 1 size low register of pcie dvsec </center></p>
<p>bits[12:8] ä¸»è¦æ˜¯memory interleaveä¹Ÿç§°ä¸ºå†…å­˜äº¤ç»‡ç›¸å…³çš„ä¸€äº›é…ç½®ï¼Œ å†…å­˜äº¤ç»‡æŠ€æœ¯ä¸»è¦æ˜¯é€šè¿‡åŒæ—¶å¹¶è¡Œè®¿é—®dramçš„å¤šä¸ªbankæ¥æå‡å†…å­˜è®¿é—®æ€§èƒ½ã€‚ä¸Šé¢çš„é…ç½®ä¸»è¦æ¶‰åŠåˆ°interleaveçš„ç²’åº¦ç›¸å…³ã€‚</p>
<p><img alt="range1_reg_3" src="images/range1_reg_3.png">
<center>å›¾10 part 3 of range 1 size low register of pcie dvsec </center></p>
<p>bits 31:28 è¡¨ç¤ºçš„æ˜¯memory sizeçš„ 31:28ä½ï¼Œbits 15:13 è¡¨ç¤ºçš„æ˜¯memory activeçš„timeoutï¼Œè¿™ä¸ªtimeoutæ˜¯ç”±ç¡¬ä»¶æ¥è®¾ç½®çš„ã€‚</p>
<p>ä¸Šé¢ä»‹ç»å®Œäº†range 1  registerçš„Size Highå’ŒSize Lowï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹Base Highå’ŒBase Lowã€‚
- Base High
regå¤§å°ä¸º32bitsï¼Œå¯¹åº”hdm memory baseå³hpaçš„èµ·å§‹åœ°å€ bits 63:32
- Base Low
regå¤§å°ä¹Ÿä¸º32bitsï¼Œå…¶ä¸­bits 31:28å¯¹åº”hdm memory baseå³hpaçš„èµ·å§‹åœ°å€ bits 31:28</p>
<p>æ³¨ï¼š<strong>å¦‚æœhdm decoderä½¿èƒ½çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸¤ä¸ªregå°†ä¸ä¼šä½¿ç”¨åˆ°ã€‚è‡³äºä»€ä¹ˆæ˜¯hdm decoderæˆ‘ä»¬ä¼šåœ¨åç»­æ–‡ç« å½“ä¸­è¯¦ç»†ä»‹ç»</strong>ã€‚</p>
<p>è®²å®Œcxl endpoint çš„PCIe DVSEC ä¹‹åï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹å¦å¤–ä¸€ä¸ªDVSECåæ—¥GPF DVSECï¼Œå…·ä½“æ ¼å¼å¦‚ä¸‹</p>
<p><img alt="gpf_dvsec" src="images/gpf_dvsec.png">
<center> å›¾11 gpf dvsec </center>
è¿™é‡Œé‡ç‚¹è®²ä¸€ä¸‹ä»€ä¹ˆæ˜¯GPFï¼Œå…¶å…¨ç§°ä¸ºGlobal Persistent Flush å…¶ä¸»è¦è´Ÿè´£åœ¨ç³»ç»Ÿæ‰ç”µçš„æ—¶å€™æŠŠin flightçš„ dataä»¥åŠcacheå½“ä¸­çš„å†…å®¹ flushåˆ°pmemå½“ä¸­ã€‚GPFæ“ä½œå¯ä»¥åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†ä»‹ç»äº†ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œå»è¯»ä¸€ä¸‹cxl specã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹è·Ÿcxl portæœ‰å…³çš„DVSECï¼Œcxl 2.0 Extensions DVSEC </p>
<p><img alt="cxl_port_dvsec" src="images/cxl_port_dvsec.png">
<center>å›¾12 cxl 2.0 extensions dvsec </center></p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯cxl 2.0 port(root portï¼Œusp, dsp) å¿…é¡»è¦åœ¨é…ç½®ç©ºé—´å®ç°è¿™ä¸ªDVSECï¼Œé€šå¸¸åœ¨cxl 2.0åè®®ä¹‹ä¸‹è¿™äº›bitå€¼å…¶æœ¬éƒ½ä¼šä½¿ç”¨default å€¼å³å…¨0ã€‚æ¥ç€å†çœ‹è·Ÿcxl port ç›¸å…³çš„å¦å¤–ä¸€ä¸ªé‡è¦çš„DVSECï¼Œå…·ä½“æ ¼å¼å¦‚ä¸‹</p>
<p><img alt="flex_bus_dvsec" src="images/flex_bus_dvsec.png">
<center>å›¾13 pcie dvsec for flex bus port </center>
è‡³äºæ¯ä¸ªbitä½çš„ç›¸å…³ç¤ºæ„å¯ä»¥è‡ªè¡Œå»çœ‹ä¸€ä¸‹specä¹Ÿæ¯”è¾ƒå¥½æ‡‚è¿™é‡Œå°±ä¸ä¸€ä¸€è¯¦è¿°äº†ã€‚å¦å¤–ï¼Œcxl port ä¹Ÿéƒ½è¦å®ç°GPF DVSECã€‚</p>
<h4>cxl memory mapped registers</h4>
<p>è®²å®Œdvsecï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹ç›¸å…³çš„registerã€‚åœ¨cxl 2.0åè®®ä¸‹æœ‰ä¸¤å¤§ç±»çš„registersï¼Œä¸€ç±»æ˜¯component registersï¼Œå®ƒåˆå¯ä»¥åˆ†ä¸ºcxl port and cxl ep component registerså’Œ CHBCR(cxl host bridge component registers)ï¼›å¦å¤–ä¸€å¤§ç±»å°±æ˜¯è·Ÿå…·ä½“è®¾å¤‡ç›¸å…³çš„device registersã€‚é™¤äº†CHBCRçš„base addressæ˜¯é€šè¿‡ACPI çš„CEDTè¡¨æ¥è¿›è¡Œæè¿°çš„ï¼Œå…¶ä»–çš„éƒ½æ˜¯éœ€è¦Register Locator DVSEC structure æ¥è¿›è¡Œæè¿°ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹register locator DVSECçš„å…·ä½“æ ¼å¼</p>
<p><img alt="reg_locator_dvsec" src="images/reg_locator_dvsec.png">
<center>å›¾14 cxl register locator dvsec </center></p>
<p>dvsec headerç›¸å…³çš„è¿™é‡Œå°±ä¸å…·ä½“è¯´äº†ï¼Œæˆ‘ä»¬å…·ä½“çœ‹ä¸€ä¸‹register blockã€‚ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°æ¯ä¸ªregister block éƒ½åŒ…å«äº†Low å’ŒHighä¸¤ä¸ªregisterï¼Œä¸‹é¢åˆ†åˆ«æ¥çœ‹ä¸€ä¸‹ç›¸å…³æ ¼å¼è¯´æ˜</p>
<p><img alt="locator_block_low" src="images/locator_block_low.png">
<center>å›¾15 cxl register block offset Low </center>
- bits 2:0
 æœ‰6ç§ä¸åŒçš„å–å€¼åˆ†åˆ«æ˜¯0åˆ°5ï¼Œæ¯ä¸ªå€¼ä¸è®¾å¤‡çš„barçš„ç¼–å·ä»¥åŠåœ¨é…ç½®ç©ºé—´çš„offsetã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœè¡¨ç¤ºçš„å€¼ä¸º1ï¼Œåˆ™è¡¨ç¤ºè¿™ä¸ªè®¾å¤‡å¿…é¡»åœ¨é…ç½®ç©ºé—´å®ç°bar1ç›¸å…³çš„å¯„å­˜å™¨ã€‚
- bits 15:8 
è¡¨ç¤ºregister blockçš„æ ¼å¼ï¼Œä»ä¸Šé¢æ¥ä¹Ÿæ˜¯æœ‰ä¸‰ç§ã€‚æ¯”è¾ƒå¸¸ç”¨çš„æ˜¯01hå’Œ03hï¼Œæ¥ä¸‹æ¥å…ˆçœ‹ä¸€ä¸‹component registersã€‚</p>
<p><img alt="cxl_cm_register" src="images/cxl_cm_register.png">
<center>å›¾16 cxl subsystem component registers ranges </center></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œcomponent registersæ€»å¤§å°ä¸º64kï¼Œå¹¶å®šä¹‰äº†ç›¸å…³registersåœ¨æ•´ä¸ªcomponent registerså½“ä¸­çš„rangeå’Œå¤§å°ã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹cxl.cacheå’Œcxl.mem registersï¼Œå®ƒä»¬å¤§å°æ€»å…±ä¸º4kBï¼Œç„¶åé€šè¿‡ä¸€ç³»åˆ—capability headeræŒ‡é’ˆæ•°ç»„çš„æ–¹å¼æ¥æè¿°å…·ä½“çš„registersã€‚å…·ä½“çœ‹ä¸€ä¸‹è¿™ä¸ªrangeçš„ç»“æ„</p>
<p><img alt="cxl_cm_range_reg" src="images/cxl_cm_range_reg.png">
<center>å›¾17 cxl.cache and cxl.mem architectural registers discovery </center>
å¦‚å›¾æ‰€ç¤ºï¼Œä»4kbå¼€å§‹offset 0å¤„æ˜¯capability headerï¼Œheaderé‡Œé¢å®šä¹‰äº†versionï¼Œcap_idï¼Œå¦å¤–å°±æ˜¯ capability headersæ•°ç»„å¤§å°ï¼Œæ¯ä¸ªcap header å¤§å°ä¸º4bytesã€‚æ¥ç€å°±æ˜¯ä¸€äº›å…·ä½“çš„cap headeräº†ï¼Œå›¾ä¸­ä¹Ÿlistäº†å¤šä¸ªä¸åŒçš„headerã€‚ä»¥hdm capä¸ºä¾‹å­ï¼Œæˆ‘æ¥çœ‹ä¸€ä¸‹å®ƒçš„å…·ä½“ç»“æ„</p>
<p><img alt="hdm_cap" src="images/hdm_cap.png">
<center> å›¾18 cxl hdm decoder capability header</center></p>
<p>é‡ç‚¹çœ‹ä¸€ä¸‹bits 31:20 å…¶è¡¨ç¤ºçš„æ˜¯ cxl  hdm capability structer å…·ä½“çš„offsetï¼Œé€šè¿‡è¿™ä¸ªoffsetå°±èƒ½æ‰¾åˆ°hdm cap å…·ä½“çš„registeräº†ã€‚å…¶ä»–çš„cap header å…·ä½“æ ¼å¼ä¹Ÿæ˜¯ç±»ä¼¼ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€èµ˜è¿°äº†ã€‚æ¥ç€çœ‹ä¸€ä¸‹ cxl mem device registerï¼Œå…ˆæ¥çœ‹ä¸€ä¸‹å…·ä½“çš„æ ¼å¼</p>
<p><img alt="cxl_device_register" src="images/cxl_device_register.png">
<center> å›¾19 cxl mem device registers </center></p>
<p>ç»“åˆä¸Šå›¾å¯ä»¥çœ‹åˆ°è·Ÿcomponent registers å®ç°æœºåˆ¶åŸºæœ¬ä¸€è‡´ï¼Œä¹Ÿæ˜¯é€šè¿‡é€šè¿‡cap header æ•°ç»„çš„æ–¹å¼æ¥æè¿°ç›¸å…³çš„regã€‚å…ˆçœ‹ä¸€ä¸‹offset 0å¤„çš„ cxl device capabilities array register</p>
<p><img alt="cxl_device_cap_array_reg" src="images/cxl_device_cap_array_reg.png">
<center> å›¾20 cxl device capabilities array register</center></p>
<p>ä¸Šå›¾å½“ä¸­æœ€é‡è¦çš„å°±æ˜¯bits 47:32 ä¹Ÿå³ capabilities countï¼Œç„¶åæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹cxl device capability header registerçš„å…·ä½“æ ¼å¼ï¼š</p>
<p><img alt="cxl_cap_header_reg" src="images/cxl_cap_header_reg.png">
<center> å›¾21 cxl device capability header register</center></p>
<p>ä¸Šå›¾ä¸­æœ‰å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„ä¿¡æ¯ä¸€ä¸ªæ˜¯bits 15:0 å®ƒæè¿°çš„æ˜¯å…·ä½“çš„capability IDï¼Œå¦å¤–ä¸€ä¸ªæ˜¯bits 63:32 æè¿°çš„æ˜¯capability register offsetï¼Œè¿˜æœ‰ä¸€ä¸ªå°±æ˜¯bits 95:64 æè¿°çš„æ˜¯capability register sizeã€‚å…³äºcxl mem device ç›¸å…³çš„capability  register å…·ä½“è§ä¸‹å›¾</p>
<p><img alt="cxl_device_caps" src="images/cxl_device_caps.png"></p>
<p><center>å›¾22 device capability ids </center></p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬èŠèŠcxl host bridgeç›¸å…³çš„memory mapped çš„registerçš„å‘ˆç°ã€‚å¤§å®¶éƒ½æ¯”è¾ƒæ¸…æ¥šï¼Œbiosä¸»è¦æ˜¯é€šè¿‡ç¡¬ä»¶acpi çš„dsdtè¡¨æ¥å‘ç°Host bridgeçš„ï¼Œé‚£ä¹ˆåœ¨pcieçš„åœºæ™¯ä¸‹bridgeç›¸å…³çš„mmioä¿¡æ¯ä¸»è¦æ˜¯é€šè¿‡crsè¡¨æ¥æè¿°çš„ã€‚è€Œåœ¨cxlåœºæ™¯ä¸‹ï¼Œå…¶ä¸»è¦æ˜¯é€šè¿‡cedtè¡¨å½“ä¸­çš„CHBS(cxl host bridge structure)æ¥æè¿°çš„ã€‚ä¸‹é¢å…ˆæ¥çœ‹ä¸€ä¸‹cedtè¡¨çš„å…·ä½“æ ¼å¼</p>
<p><img alt="cedt_header" src="images/cedt_header.png">
<center> å›¾23 cedt header</center>
ä»offset 36åœ°æ–¹å¼€å§‹å°±æ˜¯å…·ä½“çš„cedt structureäº†ï¼Œå…·ä½“çœ‹ä¸€ä¸‹structureçš„æ ¼å¼</p>
<p><img alt="chbs" src="images/chbs.png">
<center> å›¾24 CHBS structure </center>
ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°æ¯ä¸ªstructureé‡Œé¢éƒ½å®šä¹‰UID(ç”¨æ¥åŒºåˆ†è®¾å¤‡)ï¼Œcxl versionä»¥åŠregisterçš„èµ·å§‹åœ°å€ã€‚å†å›åˆ°å›¾15å½“ä¸­ï¼Œç»§ç»­å¾€ä¸‹çœ‹</p>
<ul>
<li>bits 31:16</li>
</ul>
<p>è¡¨ç¤ºè¿™ä¸ªBARç›¸å…³è”çš„cap register(component or device capability register)  address ä¸ è¿™ä¸ªbar(mmioç©ºé—´)åœ°å€çš„offset çš„31~16 ä½(<code>address_of_register = offset + base_address_of_bar</code>) </p>
<p>è®²å®Œregister  offset low çš„æ ¼å¼å†æ¥çœ‹ä¸€ä¸‹register offset high æ ¼å¼ï¼Œä¹Ÿæ¯”è¾ƒç®€å•ï¼Œè¡¨ç¤ºçš„æ˜¯offset 63:32bitsï¼š</p>
<p><img alt="register_offset_high" src="images/register_offset_high.png">
<center> å›¾25 register offset high </center></p>
<h4>æ€»ç»“</h4>
<ul>
<li>oså†…æ ¸ä¸»è¦æ˜¯é€šè¿‡ä¸€ç³»åˆ—çš„dvsec capabilitiesæ¥å‘ç°ã€é…ç½®ã€æ§åˆ¶cxl deviceã€‚</li>
<li>cxlè®¾å¤‡memory mapped registersä¸»è¦æœ‰component registesã€device registersè¿™ä¸¤å¤§ç±»ä¸»æ˜¯é€šè¿‡register locator DVSECæ¥è¿›è¡Œæè¿°ï¼Œcxl host bridge çš„CHBCRä¸»è¦æ˜¯é€šè¿‡ACPIè¡¨å½“ä¸­çš„cedtæ¥æè¿°ã€‚
ä¸Šé¢åœ¨os cxl driveré‡Œé¢æœ‰å¤§é‡çš„æ¶‰åŠï¼Œå¦‚æœå¤§å®¶æ„Ÿå…´è¶£å¯ä»¥å°è¯•é˜…è¯»ä¸€ä¸‹ç›®å‰kernel æœ€æ–°ç‰ˆå½“ä¸­çš„cxl é©±åŠ¨ã€‚ä¸‹ä¸€ç¯‡ï¼Œæˆ‘ä»¬æ¥è®²ä¸€ä¸‹cxl tye3è®¾å¤‡ã€‚</li>
</ul>

                <!-- å›¾ç‰‡ç”»å»Š -->
            </main>

        <!-- æ–‡ç« åº•éƒ¨åŒºåŸŸ -->
        <footer class="article-footer">
            <!-- æ ‡ç­¾åŒºåŸŸ -->
            <div class="article-tags-section">
                <h4>ğŸ·ï¸ ç›¸å…³æ ‡ç­¾</h4>
                <div class="tags-cloud">
                    <span class="tag-cloud-item">cxl</span>
                    <span class="tag-cloud-item">cxl hardware</span>
                </div>
            </div>

            <!-- åˆ†äº«å’Œäº’åŠ¨ -->
            <div class="article-interaction">
                <div class="social-share">
                    <h4>ğŸ”— åˆ†äº«è¿™ç¯‡æ–‡ç« </h4>
                    <div class="share-buttons">
                        <a href="#" class="share-btn twitter" target="_blank">ğ• Twitter</a>
                        <a href="#" class="share-btn weibo" target="_blank">ğŸ“ å¾®åš</a>
                        <a href="#" class="share-btn linkedin" target="_blank">ğŸ’¼ LinkedIn</a>
                    </div>
                </div>
            </div>

            <!-- ä½œè€…ç­¾åæ¡£ -->
            <div class="author-signature">
                <div class="signature-content">
                    <h4>å…³äºä½œè€…</h4>
                    <p><strong>å‘¨å®œæ³¢</strong>ï¼Œå­—èŠ‚è·³åŠ¨ç«å±±å¼•æ“AIåŸºç¡€è®¾æ–½æ¶æ„å¸ˆï¼Œä¸“æ³¨AI Agentã€GPUæ± åŒ–ã€LLMæ¨ç†ä¼˜åŒ–ç­‰å‰æ²¿æŠ€æœ¯ã€‚</p>
                    <div class="author-social">
                        <a href="https://twitter.com/zhyblife99" target="_blank">ğ• Twitter</a>
                        <span class="wechat-hint">ğŸ’¬ å…³æ³¨å¾®ä¿¡å…¬ä¼—å·è·å–æ›´å¤šå†…å®¹</span>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- ä¾§è¾¹æ  -->
    <aside class="article-sidebar">
        <!-- æ–‡ç« ä¿¡æ¯å¡ç‰‡ -->
        <div class="sidebar-card article-info-card">
            <h3>ğŸ“Š æ–‡ç« ä¿¡æ¯</h3>
            <div class="info-list">
                <div class="info-item">
                    <span class="info-label">å‘å¸ƒæ—¶é—´</span>
                    <span class="info-value">æ—¥ 24 ä¸ƒæœˆ 2022</span>
                </div>
                <div class="info-item">
                    <span class="info-label">åˆ†ç±»</span>
                    <span class="info-value">articles</span>
                </div>
                <div class="info-item">
                    <span class="info-label">é¢„è®¡é˜…è¯»</span>
                    <span class="info-value">~10 åˆ†é’Ÿ</span>
                </div>
            </div>
        </div>

        <!-- ç›¸å…³æ–‡ç« æ¨è -->
        <div class="sidebar-card related-articles-card">
            <h3>ğŸ“š ç›¸å…³æ–‡ç« </h3>
            <div class="related-list">
            </div>
        </div>

        <!-- æŠ€æœ¯æ ˆå±•ç¤º -->
        <div class="sidebar-card skills-card">
            <h3>ğŸš€ æŠ€æœ¯æ ˆ</h3>
            <div class="skills-list">
                <span class="skill-item">AI Agent</span>
                <span class="skill-item">GPUæ± åŒ–</span>
                <span class="skill-item">LLMæ¨ç†ä¼˜åŒ–</span>
                <span class="skill-item">é«˜æ€§èƒ½è™šæ‹ŸåŒ–</span>
            </div>
        </div>

        <!-- å…³æ³¨å…¬ä¼—å· -->
        <div class="sidebar-card wechat-card">
            <h3>ğŸ”” è®¢é˜…æ›´æ–°</h3>
            <div class="wechat-content">
                <p>æ‰«ç å…³æ³¨å¾®ä¿¡å…¬ä¼—å·</p>
                <img src="./images/qrcode.jpg" alt="å¾®ä¿¡å…¬ä¼—å·äºŒç»´ç " class="sidebar-qrcode">
                <p class="wechat-name">KernelNote</p>
            </div>
        </div>
    </aside>
</div>

<!-- è¿”å›é¡¶éƒ¨æŒ‰é’® -->
<button class="back-to-top" id="backToTop">
    <span>â†‘</span>
</button>

<script>
// è¿”å›é¡¶éƒ¨åŠŸèƒ½
document.addEventListener('DOMContentLoaded', function() {
    const backToTop = document.getElementById('backToTop');

    // ç›‘å¬æ»šåŠ¨äº‹ä»¶
    window.addEventListener('scroll', function() {
        if (window.pageYOffset > 300) {
            backToTop.style.display = 'block';
        } else {
            backToTop.style.display = 'none';
        }
    });

    // ç‚¹å‡»è¿”å›é¡¶éƒ¨
    backToTop.addEventListener('click', function() {
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
    });

    // ç›®å½•é«˜äº®
    const tocLinks = document.querySelectorAll('.toc-nav a');
    const headings = document.querySelectorAll('.article-content h2, .article-content h3, .article-content h4');

    function updateTocHighlight() {
        let current = '';
        headings.forEach((heading, index) => {
            const rect = heading.getBoundingClientRect();
            if (rect.top <= 100) {
                current = heading.id;
            }
        });

        tocLinks.forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('href') === '#' + current) {
                link.classList.add('active');
            }
        });
    }

    if (tocLinks.length > 0) {
        window.addEventListener('scroll', updateTocHighlight);
        updateTocHighlight();
    }

    // å¹³æ»‘æ»šåŠ¨åˆ°ç›®å½•é¡¹
    tocLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href').substring(1);
            const targetElement = document.getElementById(targetId);
            if (targetElement) {
                targetElement.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
});
</script>
                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>        <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>
    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>